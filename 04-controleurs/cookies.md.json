{
  "source_file": "04-controleurs/cookies.md",
  "title": "Cookies (Usage dans le Contrôleur)",
  "questions": [
    {
      "id": 1,
      "question": "Comment lire un cookie envoyé par le client dans un contrôleur Symfony ?",
      "type": "single_choice",
      "options": [
        "Via `$_COOKIE`.",
        "Via `$request->cookies->get('nom')`.",
        "Via `$response->headers->getCookie('nom')`.",
        "Via le service `CookieReader`."
      ],
      "correct_answers": [
        "Via `$request->cookies->get('nom')`."
      ],
      "explanation": "Les cookies font partie de la Requête entrante. On y accède via le sac de paramètres `cookies`."
    },
    {
      "id": 2,
      "question": "Comment envoyer un cookie au client (le créer/modifier) ?",
      "type": "single_choice",
      "options": [
        "En utilisant `setcookie()` de PHP natif.",
        "En l'ajoutant à la requête : `$request->cookies->set(...)`.",
        "En créant un objet `Cookie` et en l'ajoutant aux headers de la `Response`.",
        "En le mettant en session."
      ],
      "correct_answers": [
        "En créant un objet `Cookie` et en l'ajoutant aux headers de la `Response`."
      ],
      "explanation": "Les cookies sont envoyés via le header `Set-Cookie`. C'est donc une responsabilité de l'objet Response."
    },
    {
      "id": 3,
      "question": "Comment supprimer un cookie proprement ?",
      "type": "single_choice",
      "options": [
        "Appeler `$response->headers->removeCookie('name')`.",
        "Envoyer un cookie avec le même nom et une date d'expiration passée (`clearCookie` helper).",
        "Vider le cache du navigateur.",
        "On ne peut pas."
      ],
      "correct_answers": [
        "Envoyer un cookie avec le même nom et une date d'expiration passée (`clearCookie` helper)."
      ],
      "explanation": "Le protocole HTTP ne prévoit pas de commande de suppression explicite. On écrase le cookie par une version périmée."
    },
    {
      "id": 4,
      "question": "Lors de la création d'un cookie, que fait l'option `httpOnly` ?",
      "type": "single_choice",
      "options": [
        "Elle force le cookie à être envoyé uniquement en HTTP (pas HTTPS).",
        "Elle empêche le code JavaScript côté client (`document.cookie`) d'accéder au cookie.",
        "Elle chiffre le cookie.",
        "Elle le rend temporaire."
      ],
      "correct_answers": [
        "Elle empêche le code JavaScript côté client (`document.cookie`) d'accéder au cookie."
      ],
      "explanation": "C'est une protection contre le vol de session via XSS (Cross-Site Scripting)."
    },
    {
      "id": 5,
      "question": "Quelle est la différence entre modifier `$request->cookies` et `$response->headers->setCookie` ?",
      "type": "single_choice",
      "options": [
        "Aucune.",
        "`$request->cookies` modifie la valeur pour le script courant (lecture immédiate), `$response` envoie l'ordre au navigateur pour les prochaines requêtes.",
        "`$request` est persistant, `$response` est temporaire.",
        "`$response` est déprécié."
      ],
      "correct_answers": [
        "`$request->cookies` modifie la valeur pour le script courant (lecture immédiate), `$response` envoie l'ordre au navigateur pour les prochaines requêtes."
      ],
      "explanation": "Pour que l'utilisateur 'garde' le cookie, il faut impérativement passer par la Response."
    },
    {
      "id": 6,
      "question": "Pour supprimer un cookie, est-il suffisant de donner son nom ?",
      "type": "single_choice",
      "options": [
        "Oui, le nom suffit.",
        "Non, il faut impérativement que le chemin (path), le domaine et l'option secure correspondent à ceux utilisés lors de la création.",
        "Oui, sauf si c'est un cookie de session.",
        "Non, il faut connaître sa valeur."
      ],
      "correct_answers": [
        "Non, il faut impérativement que le chemin (path), le domaine et l'option secure correspondent à ceux utilisés lors de la création."
      ],
      "explanation": "Le navigateur identifie le cookie par le triplet (Nom + Domaine + Path). Si ces paramètres diffèrent, un deuxième cookie sera créé au lieu d'écraser l'ancien."
    },
    {
      "id": 7,
      "question": "Quand est-ce que le header `Set-Cookie` est effectivement généré et envoyé ?",
      "type": "single_choice",
      "options": [
        "Dès l'appel à `$response->headers->setCookie()`.",
        "Au moment de l'appel à `$response->send()`.",
        "À la fin du contrôleur.",
        "Immédiatement."
      ],
      "correct_answers": [
        "Au moment de l'appel à `$response->send()`."
      ],
      "explanation": "Les cookies sont stockés dans le `ResponseHeaderBag` et convertis en headers HTTP string uniquement lors de l'envoi final."
    }
  ]
}