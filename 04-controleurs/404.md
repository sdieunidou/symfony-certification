# G√©n√©rer des pages 404 (Not Found)

## Concept cl√©
Le protocole HTTP d√©finit le code **404** pour indiquer qu'une ressource n'existe pas.
Dans un contr√¥leur Symfony, vous ne retournez pas une `Response` avec un statut 404 manuellement. Vous lancez une **Exception**.
Cela permet au Kernel d'intercepter l'erreur et de rendre une page d'erreur standardis√©e (ou JSON) via l'ErrorHandling.

## M√©thodes pour d√©clencher une 404

### 1. Via `AbstractController` (Recommand√©)
La m√©thode helper `createNotFoundException()` cr√©e une `Symfony\Component\HttpKernel\Exception\NotFoundHttpException`.

```php
public function show(int $id, ProductRepository $repo): Response
{
    $product = $repo->find($id);
    
    if (!$product) {
        // Arr√™te l'ex√©cution imm√©diatement
        throw $this->createNotFoundException(sprintf('Le produit #%d n\'existe pas.', $id));
    }
    
    return $this->render('product/show.html.twig', ['product' => $product]);
}
```

### 2. Via Doctrine ParamConverter (Automatique)
Si vous typez l'argument avec une Entit√© Doctrine, Symfony tente de la trouver via l'ID dans l'URL.
Si elle n'est pas trouv√©e, une 404 est lanc√©e **automatiquement**.

```php
// Si l'URL est /product/999 et que l'ID 999 n'existe pas -> 404 Auto
#[Route('/product/{id}')]
public function show(Product $product): Response 
{
    return $this->render('...', ['product' => $product]);
}
```

Pour d√©sactiver ce comportement (rendre l'argument optionnel) :
```php
public function show(?Product $product): Response
{
    if (!$product) {
        return $this->render('product/empty.html.twig'); // Pas de 404
    }
}
```

### 3. Via les Attributs (Symfony 6.3+)
L'attribut `#[MapEntity]` permet de configurer le comportement si non trouv√©.

```php
use Symfony\Bridge\Doctrine\Attribute\MapEntity;

public function show(
    #[MapEntity(expr: 'repository.findActive(id)')] Product $product
): Response
```

## Personnaliser la page 404
Symfony utilise TwigBundle pour le rendu.
Cr√©ez le fichier `templates/bundles/TwigBundle/Exception/error404.html.twig`.

```twig
{# templates/bundles/TwigBundle/Exception/error404.html.twig #}
{% extends 'base.html.twig' %}

{% block body %}
    <h1>Oups ! Page introuvable.</h1>
    <p>Le message d'erreur √©tait : {{ exception.message }}</p>
    <a href="{{ path('homepage') }}">Retour √† l'accueil</a>
{% endblock %}
```

**Note** : En mode `APP_ENV=dev`, vous verrez toujours la page de debug Symfony. Pour voir votre template, acc√©dez √† une URL sp√©ciale (si configur√©e) ou passez temporairement en `APP_ENV=prod` (n'oubliez pas de vider le cache).
Une astuce consiste √† utiliser la route de pr√©visualisation des erreurs (voir `routes/dev/framework.yaml`) : `/_error/404`.

## üß† Concepts Cl√©s
1.  **Exception = Interruption** : Lancer une exception 404 interrompt le flux normal. Le code apr√®s le `throw` n'est jamais ex√©cut√©.
2.  **S√©curit√©** : Attention aux messages d'erreur. En prod, le message pass√© √† `createNotFoundException` peut √™tre affich√© √† l'utilisateur (selon votre template). Ne mettez pas d'infos sensibles.

## ‚ö†Ô∏è Points de vigilance (Certification)
*   **404 vs 403** : Si la ressource existe mais que l'utilisateur n'a pas le droit de la voir, ce n'est PAS une 404, c'est une **403 Access Denied**. (Sauf si vous voulez masquer l'existence de la ressource pour des raisons de s√©curit√© stricte, alors une 404 est acceptable).
*   **API** : Si le format de requ√™te est JSON, le m√©canisme d'erreur de Symfony retournera un JSON avec `status: 404` (si configur√© correctement), et non le template HTML.

## Ressources
*   [Symfony Docs - 404 Pages](https://symfony.com/doc/current/controller.html#managing-errors-and-404-pages)
*   [Customizing Error Pages](https://symfony.com/doc/current/controller/error_pages.html)
