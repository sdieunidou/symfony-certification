{
  "source_file": "10-securite/authorization.md",
  "title": "Autorisation (AuthZ)",
  "questions": [
    {
      "id": 1,
      "question": "Quel composant est responsable de la prise de décision finale d'accès (Voter) ?",
      "type": "single_choice",
      "options": [
        "Authenticator",
        "AccessDecisionManager",
        "Firewall",
        "UserProvider"
      ],
      "correct_answers": [
        "AccessDecisionManager"
      ],
      "explanation": "Il interroge tous les Voters et applique une stratégie (affirmative, consensus, unanimous)."
    },
    {
      "id": 2,
      "question": "Comment vérifier une permission dans un contrôleur (`AbstractController`) ?",
      "type": "single_choice",
      "options": [
        "`$this->canAccess('ROLE')`",
        "`$this->isGranted('ROLE')` ou `$this->denyAccessUnlessGranted('ROLE')`",
        "`$this->checkAccess('ROLE')`",
        "`$this->authorize('ROLE')`"
      ],
      "correct_answers": [
        "`$this->isGranted('ROLE')` ou `$this->denyAccessUnlessGranted('ROLE')`"
      ],
      "explanation": "`isGranted` retourne un booléen, `denyAccessUnlessGranted` lance une exception 403 si faux."
    },
    {
      "id": 3,
      "question": "Quel attribut PHP permet de sécuriser une classe ou une méthode de contrôleur de manière déclarative ?",
      "type": "single_choice",
      "options": [
        "`#[Route]`",
        "`#[IsGranted('ROLE_ADMIN')]`",
        "`#[Secure]`",
        "`#[Auth]`"
      ],
      "correct_answers": [
        "`#[IsGranted('ROLE_ADMIN')]`"
      ],
      "explanation": "C'est la méthode moderne recommandée."
    },
    {
      "id": 4,
      "question": "Quelle est la stratégie par défaut de l'`AccessDecisionManager` ?",
      "type": "single_choice",
      "options": [
        "Unanimous (Tous les voters doivent dire oui).",
        "Affirmative (Dès qu'un voter dit oui, l'accès est accordé).",
        "Consensus (Majorité).",
        "Priority."
      ],
      "correct_answers": [
        "Affirmative (Dès qu'un voter dit oui, l'accès est accordé)."
      ],
      "explanation": "Cela signifie que si un seul voter (ex: RoleVoter) accorde l'accès, c'est validé, même si les autres s'abstiennent."
    },
    {
      "id": 5,
      "question": "Si l'accès est refusé (`isGranted` retourne false), que se passe-t-il selon que l'utilisateur est connecté ou non ?",
      "type": "single_choice",
      "options": [
        "Erreur 403 dans les deux cas.",
        "Erreur 401 dans les deux cas.",
        "Si connecté: Exception 403 (`AccessDeniedException`). Si non connecté: Redirection vers le login (ou 401) via l'`AuthenticationEntryPoint`.",
        "Rien, le code continue."
      ],
      "correct_answers": [
        "Si connecté: Exception 403 (`AccessDeniedException`). Si non connecté: Redirection vers le login (ou 401) via l'`AuthenticationEntryPoint`."
      ],
      "explanation": "C'est le comportement standard : si on ne sait pas qui c'est, on lui demande de se connecter. Si on sait qui c'est mais qu'il n'a pas le droit, on lui interdit l'accès."
    },
    {
      "id": 6,
      "question": "Quelle stratégie de décision utiliser si vous souhaitez que toute objection d'un voter bloque l'accès ?",
      "type": "single_choice",
      "options": [
        "unanimous",
        "affirmative",
        "consensus",
        "priority"
      ],
      "correct_answers": [
        "unanimous"
      ],
      "explanation": "En stratégie `unanimous`, tous les voters non abstains doivent dire OUI."
    },
    {
      "id": 7,
      "question": "Quel voter gère les rôles commençant par `ROLE_` ?",
      "type": "single_choice",
      "options": [
        "RoleVoter",
        "AuthenticatedVoter",
        "ExpressionVoter",
        "AccessDecisionVoter"
      ],
      "correct_answers": [
        "RoleVoter"
      ],
      "explanation": "RoleVoter vote sur les attributs `ROLE_*`."
    },
    {
      "id": 8,
      "question": "Comment sécuriser déclarativement une méthode de contrôleur ?",
      "type": "single_choice",
      "options": [
        "Avec l'attribut `#[IsGranted(...)]`",
        "Avec un commentaire PHPDoc",
        "Avec un middleware",
        "Impossible"
      ],
      "correct_answers": [
        "Avec l'attribut `#[IsGranted(...)]`"
      ],
      "explanation": "L'attribut est la méthode moderne recommandée."
    },
    {
      "id": 9,
      "question": "Quel service injecter dans un service pour tester une permission ?",
      "type": "single_choice",
      "options": [
        "AuthorizationCheckerInterface",
        "SecurityHelper",
        "FirewallInterface",
        "UserProviderInterface"
      ],
      "correct_answers": [
        "AuthorizationCheckerInterface"
      ],
      "explanation": "AuthorizationChecker expose isGranted() pour tester les droits."
    },
    {
      "id": 10,
      "question": "Que fait l'attribut `#[IsGranted('POST_EDIT', subject: 'post')]` sur une action ?",
      "type": "single_choice",
      "options": [
        "Il déclenche un voter avec l'attribut POST_EDIT et l'argument $post comme sujet",
        "Il redirige vers /login automatiquement",
        "Il change le route name",
        "Il met en cache la réponse"
      ],
      "correct_answers": [
        "Il déclenche un voter avec l'attribut POST_EDIT et l'argument $post comme sujet"
      ],
      "explanation": "Le sujet est résolu automatiquement par nom de paramètre."
    }
  ]
}