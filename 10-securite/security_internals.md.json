{
  "source_file": "10-securite/security_internals.md",
  "title": "Sécurité : Fonctionnement Interne",
  "questions": [
    {
      "id": 1,
      "question": "Quel service est responsable de stocker l'objet représentant l'utilisateur authentifié (Token) pendant la requête ?",
      "type": "single_choice",
      "options": [
        "AuthenticationManager",
        "TokenStorage",
        "Session",
        "UserProvider"
      ],
      "correct_answers": [
        "TokenStorage"
      ],
      "explanation": "C'est le service `security.token_storage` qui détient le token courant."
    },
    {
      "id": 2,
      "question": "Quel est le rôle d'un `UserProvider` ?",
      "type": "single_choice",
      "options": [
        "Vérifier le mot de passe.",
        "Décider si l'utilisateur a accès à une page.",
        "Charger l'objet User à partir d'un identifiant (ex: email).",
        "Hasher les mots de passe."
      ],
      "correct_answers": [
        "Charger l'objet User à partir d'un identifiant (ex: email)."
      ],
      "explanation": "Il fait le pont entre le système de sécurité et votre stockage de données (Doctrine, LDAP, etc.)."
    },
    {
      "id": 3,
      "question": "Qui prend la décision finale d'accorder ou non l'accès lors d'un appel à `is_granted` (basé sur les votes des Voters) ?",
      "type": "single_choice",
      "options": [
        "AccessDecisionManager",
        "Firewall",
        "AuthorizationChecker",
        "Kernel"
      ],
      "correct_answers": [
        "AccessDecisionManager"
      ],
      "explanation": "Il collecte les votes de tous les Voters applicables et applique la stratégie (ex: affirmative = un seul OUI suffit)."
    },
    {
      "id": 4,
      "question": "Qu'est-ce qu'un `Passport` dans le nouveau système d'authentification ?",
      "type": "single_choice",
      "options": [
        "Un document de voyage.",
        "Un objet DTO retourné par `authenticate()` contenant l'utilisateur et les preuves (badges) de son identité.",
        "Le token stocké en session.",
        "Une clé API."
      ],
      "correct_answers": [
        "Un objet DTO retourné par `authenticate()` contenant l'utilisateur et les preuves (badges) de son identité."
      ],
      "explanation": "Le Passport simplifie la gestion des différentes étapes (Check CSRF, Check Password, Remember Me) via des 'Badges'."
    },
    {
      "id": 5,
      "question": "Techniquement, qu'est-ce qu'un Firewall dans l'architecture Symfony ?",
      "type": "single_choice",
      "options": [
        "Un contrôleur.",
        "Un middleware PSR-15.",
        "Un Event Listener sur l'événement `kernel.request`.",
        "Un service Twig."
      ],
      "correct_answers": [
        "Un Event Listener sur l'événement `kernel.request`."
      ],
      "explanation": "Il intercepte la requête très tôt pour vérifier l'authentification avant que le contrôleur ne soit atteint."
    },
    {
      "id": 6,
      "question": "Que stocke la session en matière de sécurité ?",
      "type": "single_choice",
      "options": [
        "Le token de sécurité (sérialisé) pour éviter de réauthentifier à chaque requête stateful",
        "Les mots de passe en clair",
        "Les rôles uniquement",
        "Rien, la session n'est pas utilisée"
      ],
      "correct_answers": [
        "Le token de sécurité (sérialisé) pour éviter de réauthentifier à chaque requête stateful"
      ],
      "explanation": "Le token est rechargé puis rafraîchi via le provider."
    },
    {
      "id": 7,
      "question": "Dans un firewall `stateless: true`, le token est-il stocké en session ?",
      "type": "single_choice",
      "options": [
        "Non, il doit être fourni à chaque requête (ex: JWT)",
        "Oui",
        "Uniquement en dev",
        "Uniquement pour remember-me"
      ],
      "correct_answers": [
        "Non, il doit être fourni à chaque requête (ex: JWT)"
      ],
      "explanation": "Stateless supprime toute persistance côté serveur."
    },
    {
      "id": 8,
      "question": "Quel composant vérifie les badges d'un Passport (CSRF, Password, User) ?",
      "type": "single_choice",
      "options": [
        "AuthenticationManager via le `CheckPassportEvent`",
        "TokenStorage",
        "FirewallMap",
        "RoleHierarchy"
      ],
      "correct_answers": [
        "AuthenticationManager via le `CheckPassportEvent`"
      ],
      "explanation": "Des listeners résolvent chaque badge sur cet event."
    },
    {
      "id": 9,
      "question": "Quel service utiliser dans un service métier pour vérifier un droit ?",
      "type": "single_choice",
      "options": [
        "AuthorizationCheckerInterface",
        "TokenStorageInterface",
        "FirewallContext",
        "UserProviderInterface"
      ],
      "correct_answers": [
        "AuthorizationCheckerInterface"
      ],
      "explanation": "Expose `isGranted()`."
    },
    {
      "id": 10,
      "question": "Quels sont les trois éléments majeurs du flux AuthN/AuthZ en Symfony ?",
      "type": "single_choice",
      "options": [
        "Firewall + Authenticator/Passport + Voters/AccessDecisionManager",
        "Router + Controller + Twig",
        "Kernel + Cache + Logger",
        "DI Container + Messenger + Mailer"
      ],
      "correct_answers": [
        "Firewall + Authenticator/Passport + Voters/AccessDecisionManager"
      ],
      "explanation": "Firewall identifie, Passport transporte, Voters décident."
    }
  ]
}