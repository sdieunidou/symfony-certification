{
  "source_file": "18-api/stateless-auth.md",
  "title": "Authentification Stateless & Tokens",
  "questions": [
    {
      "id": 1,
      "question": "Pourquoi `stateless: true` est-il essentiel sur le firewall d'une API ?",
      "type": "multiple_choice",
      "options": [
        "Désactive la session/cookie `PHPSESSID`",
        "Force chaque requête à porter son token",
        "Évite d'épingler un serveur spécifique (scalabilité)",
        "Active CORS automatiquement"
      ],
      "correct_answers": [
        "Désactive la session/cookie `PHPSESSID`",
        "Force chaque requête à porter son token",
        "Évite d'épingler un serveur spécifique (scalabilité)"
      ],
      "explanation": "Stateless = pas de session, authent portées par la requête, facilite le scaling."
    },
    {
      "id": 2,
      "question": "Comment fonctionne le système Access Token authenticator (Symfony 6.2+) ?",
      "type": "multiple_choice",
      "options": [
        "Il extrait le token (Bearer/query/header custom) selon config",
        "Il délègue la validation à un `AccessTokenHandlerInterface`",
        "Il renvoie un `UserBadge` pour le UserProvider",
        "Il stocke le token en session"
      ],
      "correct_answers": [
        "Il extrait le token (Bearer/query/header custom) selon config",
        "Il délègue la validation à un `AccessTokenHandlerInterface`",
        "Il renvoie un `UserBadge` pour le UserProvider"
      ],
      "explanation": "Le handler vérifie le token et retourne un UserBadge ; pas de session."
    },
    {
      "id": 3,
      "question": "Quels avantages/inconvénients clés des JWT sont mentionnés ?",
      "type": "multiple_choice",
      "options": [
        "Self-contained, pas besoin d'appeler la BDD à chaque requête",
        "Validation par signature",
        "Révocation difficile (liste noire/exp courte)",
        "Toujours chiffrés nativement"
      ],
      "correct_answers": [
        "Self-contained, pas besoin d'appeler la BDD à chaque requête",
        "Validation par signature",
        "Révocation difficile (liste noire/exp courte)"
      ],
      "explanation": "JWT = performant mais révocation compliquée ; pas forcément chiffré (signé)."
    },
    {
      "id": 4,
      "question": "Que doit retourner un `ApiTokenHandler` quand le token est valide ?",
      "type": "single_choice",
      "options": [
        "Un `UserBadge` avec l'identifiant utilisateur",
        "Un booléen true",
        "Une Response",
        "Une session"
      ],
      "correct_answers": [
        "Un `UserBadge` avec l'identifiant utilisateur"
      ],
      "explanation": "Le UserBadge est ensuite résolu par le UserProvider."
    },
    {
      "id": 5,
      "question": "Quelles sont les contraintes CORS à ne pas oublier avec un header Authorization en navigateur ?",
      "type": "multiple_choice",
      "options": [
        "Autoriser le header `Authorization` dans `Access-Control-Allow-Headers`",
        "Autoriser l'origine dans `Access-Control-Allow-Origin`",
        "Permettre les requêtes OPTIONS (preflight)",
        "Toujours mettre `Access-Control-Allow-Origin: *` avec credentials"
      ],
      "correct_answers": [
        "Autoriser le header `Authorization` dans `Access-Control-Allow-Headers`",
        "Autoriser l'origine dans `Access-Control-Allow-Origin`",
        "Permettre les requêtes OPTIONS (preflight)"
      ],
      "explanation": "CORS doit autoriser origin+headers et preflight ; wildcard+credentials est interdit."
    },
    {
      "id": 6,
      "question": "Quels usages typiques pour les API Keys (header `X-API-KEY`) ?",
      "type": "single_choice",
      "options": [
        "Communication machine-à-machine (M2M)",
        "Authentification de formulaires HTML",
        "Sessions front",
        "Streaming vidéo"
      ],
      "correct_answers": [
        "Communication machine-à-machine (M2M)"
      ],
      "explanation": "API keys sont fréquentes pour M2M, souvent via header custom."
    },
    {
      "id": 7,
      "question": "Quel rôle garde le UserProvider dans une API stateless ?",
      "type": "single_choice",
      "options": [
        "Recharger l'utilisateur complet (rôles, données) à partir de l'identifiant du token",
        "Stocker la session",
        "Gérer les CORS",
        "Servir les fichiers statiques"
      ],
      "correct_answers": [
        "Recharger l'utilisateur complet (rôles, données) à partir de l'identifiant du token"
      ],
      "explanation": "UserProvider reste nécessaire pour construire le User après le UserBadge."
    },
    {
      "id": 8,
      "question": "Pourquoi la révocation des JWT est-elle difficile ?",
      "type": "single_choice",
      "options": [
        "Parce que le serveur ne stocke pas l'état du token ; il faut une blacklist ou une expiration courte",
        "Parce qu'ils sont chiffrés",
        "Parce qu'ils nécessitent Redis",
        "Parce qu'ils sont en XML"
      ],
      "correct_answers": [
        "Parce que le serveur ne stocke pas l'état du token ; il faut une blacklist ou une expiration courte"
      ],
      "explanation": "Les JWT sont vérifiés localement ; révoquer exige stratégie dédiée."
    },
    {
      "id": 9,
      "question": "Quel header porte typiquement un token Bearer ?",
      "type": "single_choice",
      "options": [
        "Authorization: Bearer <token>",
        "Cookie: token",
        "X-Csrf-Token",
        "Content-Type"
      ],
      "correct_answers": [
        "Authorization: Bearer <token>"
      ],
      "explanation": "Bearer est le schéma standard dans Authorization."
    },
    {
      "id": 10,
      "question": "Quels risques si `stateless: true` est oublié sur un firewall API ?",
      "type": "multiple_choice",
      "options": [
        "Sessions créées inutilement",
        "Sticky sessions sur un seul serveur",
        "Perte des bénéfices du scaling horizontal",
        "Désactivation des CORS"
      ],
      "correct_answers": [
        "Sessions créées inutilement",
        "Sticky sessions sur un seul serveur",
        "Perte des bénéfices du scaling horizontal"
      ],
      "explanation": "Sans stateless, sessions et affinité peuvent nuire à la scalabilité."
    }
  ]
}
