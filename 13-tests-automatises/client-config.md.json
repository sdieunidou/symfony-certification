{
  "source_file": "13-tests-automatises/client-config.md",
  "title": "Configuration du Client de Test (KernelBrowser)",
  "questions": [
    {
      "id": 1,
      "question": "Quel fichier d'environnement est spécifiquement ignoré lors de l'exécution des tests pour garantir la cohérence ?",
      "type": "single_choice",
      "options": [
        "`.env`",
        "`.env.test`",
        "`.env.local`",
        "`.env.test.local`"
      ],
      "correct_answers": [
        "`.env.local`"
      ],
      "explanation": "Le fichier `.env.local` contient souvent des config machine-spécifique pour le développement. En test, on veut un environnement reproductible, donc il est ignoré au profit de `.env.test`."
    },
    {
      "id": 2,
      "question": "Par défaut, le client de test suit-il les redirections HTTP (codes 3xx) ?",
      "type": "single_choice",
      "options": [
        "Oui, toujours.",
        "Non, il s'arrête sur la réponse de redirection pour permettre de la tester.",
        "Oui, mais seulement les 301.",
        "Cela dépend de la configuration du navigateur."
      ],
      "correct_answers": [
        "Non, il s'arrête sur la réponse de redirection pour permettre de la tester."
      ],
      "explanation": "Pour suivre une redirection, il faut appeler explicitement `$client->followRedirect()` ou activer le suivi automatique avec `$client->followRedirects(true)`."
    },
    {
      "id": 3,
      "question": "Pourquoi configurer `$client->catchExceptions(false)` lors du debugging d'un test ?",
      "type": "single_choice",
      "options": [
        "Pour empêcher le test d'échouer.",
        "Pour laisser l'exception remonter jusqu'à PHPUnit et voir la Stack Trace dans la console au lieu d'une page HTML d'erreur 500.",
        "Pour désactiver le profiler.",
        "Pour tester le gestionnaire d'exceptions personnalisé."
      ],
      "correct_answers": [
        "Pour laisser l'exception remonter jusqu'à PHPUnit et voir la Stack Trace dans la console au lieu d'une page HTML d'erreur 500."
      ],
      "explanation": "C'est une pratique courante : si `catchExceptions` est true (défaut), Symfony attrape l'erreur et rend une Response 500. Si false, PHPUnit attrape l'exception et affiche les détails."
    },
    {
      "id": 4,
      "question": "Quelle méthode permet de définir des en-têtes HTTP par défaut pour toutes les requêtes du client ?",
      "type": "single_choice",
      "options": [
        "`$client->setHeaders([...])`",
        "`$client->setServerParameters([...])`",
        "`$client->setDefaultOptions([...])`",
        "`$client->config([...])`"
      ],
      "correct_answers": [
        "`$client->setServerParameters([...])`"
      ],
      "explanation": "On utilise `setServerParameters` en passant des clés au format PHP `$_SERVER` (ex: `HTTP_AUTHORIZATION`)."
    },
    {
      "id": 5,
      "question": "Comment passer des options comme `HTTP_HOST` ou `HTTPS` lors de la création du client ?",
      "type": "single_choice",
      "options": [
        "En argument de `createClient()` : `static::createClient([], ['HTTP_HOST' => 'api.com'])`.",
        "Dans le fichier `.env.test`.",
        "Dans le constructeur du test.",
        "Ce n'est pas possible."
      ],
      "correct_answers": [
        "En argument de `createClient()` : `static::createClient([], ['HTTP_HOST' => 'api.com'])`."
      ],
      "explanation": "Le deuxième argument de `createClient` est un tableau de paramètres serveur passés au Kernel."
    },
    {
      "id": 6,
      "question": "Pourquoi ignorer `.env.local` en test ?",
      "type": "single_choice",
      "options": [
        "Pour garantir la reproductibilité entre machines",
        "Parce qu'il est vide",
        "Parce qu'il supprime les logs",
        "Pour activer le profiler"
      ],
      "correct_answers": [
        "Pour garantir la reproductibilité entre machines"
      ],
      "explanation": "Les spécificités locales ne doivent pas influencer l'environnement de test."
    },
    {
      "id": 7,
      "question": "Comment laisser une exception remonter jusqu'à PHPUnit au lieu d'une page 500 HTML ?",
      "type": "single_choice",
      "options": [
        "`$client->catchExceptions(false);`",
        "`$client->throwExceptions();`",
        "`APP_DEBUG=1`",
        "Impossible"
      ],
      "correct_answers": [
        "`$client->catchExceptions(false);`"
      ],
      "explanation": "On désactive la capture pour obtenir la trace directement dans la console."
    },
    {
      "id": 8,
      "question": "Comment activer le suivi automatique des redirections ?",
      "type": "single_choice",
      "options": [
        "`$client->followRedirects(true);`",
        "`$client->autoRedirect();`",
        "`$client->followRedirect();`",
        "`$client->enableRedirects();`"
      ],
      "correct_answers": [
        "`$client->followRedirects(true);`"
      ],
      "explanation": "Par défaut false pour inspecter les 3xx."
    },
    {
      "id": 9,
      "question": "Pourquoi définir `HTTP_HOST`/`HTTPS` dans `createClient` peut être critique ?",
      "type": "single_choice",
      "options": [
        "Tester le routing par hôte ou les règles de sécurité (firewalls) dépendantes du schéma",
        "Accélérer le client",
        "Obligatoire pour Twig",
        "Pour activer le cache"
      ],
      "correct_answers": [
        "Tester le routing par hôte ou les règles de sécurité (firewalls) dépendantes du schéma"
      ],
      "explanation": "Certaines routes/configs varient selon le host/https."
    },
    {
      "id": 10,
      "question": "Comment définir un User-Agent global pour toutes les requêtes ?",
      "type": "single_choice",
      "options": [
        "`$client->setServerParameters(['HTTP_USER_AGENT' => 'Tests']);`",
        "`$client->setHeaders(['User-Agent' => 'Tests']);`",
        "`$client->userAgent('Tests');`",
        "Impossible"
      ],
      "correct_answers": [
        "`$client->setServerParameters(['HTTP_USER_AGENT' => 'Tests']);`"
      ],
      "explanation": "Les headers par défaut se configurent via setServerParameters."
    }
  ]
}