{
  "source_file": "13-tests-automatises/profiler.md",
  "title": "Objet Profiler (Tests Fonctionnels)",
  "questions": [
    {
      "id": 1,
      "question": "Dans un test fonctionnel, comment accéder aux données de performance et aux logs de la requête effectuée (comme dans la Web Debug Toolbar) ?",
      "type": "single_choice",
      "options": [
        "En regardant les fichiers de logs.",
        "En récupérant l'objet `Profiler` via `$client->getProfile()`.",
        "En utilisant le crawler.",
        "C'est impossible en test."
      ],
      "correct_answers": [
        "En récupérant l'objet `Profiler` via `$client->getProfile()`."
      ],
      "explanation": "Le profiler doit être activé (`enableProfiler()`) pour que cela fonctionne."
    },
    {
      "id": 2,
      "question": "Comment vérifier qu'un email a bien été envoyé lors d'une requête testée ?",
      "type": "single_choice",
      "options": [
        "En vérifiant la boîte mail.",
        "En inspectant le collecteur `mailer` du Profiler.",
        "En mockant le service mailer (possible mais complexe en fonctionnel).",
        "Les deux dernières réponses sont valides."
      ],
      "correct_answers": [
        "Les deux dernières réponses sont valides."
      ],
      "explanation": "L'inspection du Profiler est la méthode 'boîte noire' préférée : `$client->getProfile()->getCollector('mailer')`."
    },
    {
      "id": 3,
      "question": "Si la requête entraîne une redirection, que retourne `$client->getProfile()` ?",
      "type": "single_choice",
      "options": [
        "Le profil de la première requête (avant redirection).",
        "Le profil de la dernière requête (après redirection).",
        "Un tableau de tous les profils.",
        "Null."
      ],
      "correct_answers": [
        "Le profil de la dernière requête (après redirection)."
      ],
      "explanation": "Le client suit les redirections par défaut. Pour avoir le profil de la redirection elle-même, il faut désactiver `followRedirects`."
    },
    {
      "id": 4,
      "question": "Faut-il activer le profiler pour tous les tests ?",
      "type": "single_choice",
      "options": [
        "Oui, c'est mieux.",
        "Non, car cela consomme beaucoup de mémoire et ralentit l'exécution des tests.",
        "Oui, c'est obligatoire.",
        "Seulement en prod."
      ],
      "correct_answers": [
        "Non, car cela consomme beaucoup de mémoire et ralentit l'exécution des tests."
      ],
      "explanation": "Activez-le uniquement pour les tests qui ont besoin de vérifier des données techniques (emails, db queries)."
    },
    {
      "id": 5,
      "question": "Comment activer le profiler avant d'appeler `request()` ?",
      "type": "single_choice",
      "options": [
        "`$client->enableProfiler();`",
        "`$client->startProfiler();`",
        "`APP_DEBUG=1`",
        "Il est toujours actif"
      ],
      "correct_answers": [
        "`$client->enableProfiler();`"
      ],
      "explanation": "Sans activation, `getProfile()` retournera null pour économiser des ressources."
    },
    {
      "id": 6,
      "question": "Quel collecteur fournit le nombre de requêtes SQL exécutées ?",
      "type": "single_choice",
      "options": [
        "`$profile->getCollector('db')`",
        "`$profile->getCollector('doctrine')`",
        "`$profile->getCollector('orm')`",
        "`$profile->getCollector('database')`"
      ],
      "correct_answers": [
        "`$profile->getCollector('db')`"
      ],
      "explanation": "Le collector 'db' expose getQueryCount() et les requêtes."
    },
    {
      "id": 7,
      "question": "Comment récupérer les emails envoyés via le profiler ?",
      "type": "single_choice",
      "options": [
        "`$profile->getCollector('mailer')->getEvents()`",
        "`$profile->getCollector('mail')`",
        "`$client->getMails()`",
        "Impossible"
      ],
      "correct_answers": [
        "`$profile->getCollector('mailer')->getEvents()`"
      ],
      "explanation": "Le collecteur mailer expose les messages envoyés pour assertions."
    },
    {
      "id": 8,
      "question": "Pourquoi éviter d'activer le profiler globalement sur toute la suite ?",
      "type": "single_choice",
      "options": [
        "Coût mémoire/temps élevé",
        "Il casse Twig",
        "Il supprime les logs",
        "Il empêche les redirections"
      ],
      "correct_answers": [
        "Coût mémoire/temps élevé"
      ],
      "explanation": "On l'active seulement sur les tests nécessitant ses données."
    },
    {
      "id": 9,
      "question": "Quel header HTTP donne le lien direct du profil pour une requête API ?",
      "type": "single_choice",
      "options": [
        "`X-Debug-Token-Link`",
        "`X-Profiler`",
        "`X-Debug`",
        "`X-Symfony-Profile`"
      ],
      "correct_answers": [
        "`X-Debug-Token-Link`"
      ],
      "explanation": "Pratique quand la WDT n'est pas affichée (AJAX/API)."
    },
    {
      "id": 10,
      "question": "Que retourne `$client->getProfile()` si le profiler est désactivé ?",
      "type": "single_choice",
      "options": [
        "null",
        "Une exception",
        "Le dernier profil quand même",
        "Un tableau"
      ],
      "correct_answers": [
        "null"
      ],
      "explanation": "Sans activation, aucun profil n'est collecté."
    }
  ]
}