{
  "source_file": "14-divers/zero-downtime.md",
  "title": "Déploiement Zéro Downtime (ZDD)",
  "questions": [
    {
      "id": 1,
      "question": "Principe d'un déploiement ZDD ?",
      "type": "single_choice",
      "options": [
        "Déployer en parallèle puis basculer le trafic instantanément (symlink ou load balancer)",
        "Mettre en maintenance",
        "FTP direct",
        "Écraser les fichiers en place"
      ],
      "correct_answers": [
        "Déployer en parallèle puis basculer le trafic instantanément (symlink ou load balancer)"
      ],
      "explanation": "L'utilisateur ne doit pas voir d'interruption."
    },
    {
      "id": 2,
      "question": "Comment gérer les sessions PHP lors d'un déploiement sur plusieurs serveurs ou lors d'un basculement ?",
      "type": "single_choice",
      "options": [
        "Utiliser le stockage de fichiers par défaut.",
        "Utiliser un stockage de session partagé (Redis, Base de données).",
        "Demander à l'utilisateur de se reconnecter.",
        "Utiliser des cookies non sécurisés."
      ],
      "correct_answers": [
        "Utiliser un stockage de session partagé (Redis, Base de données)."
      ],
      "explanation": "Si les sessions sont dans des fichiers locaux, elles sont perdues si l'utilisateur change de serveur."
    },
    {
      "id": 3,
      "question": "Quelle stratégie adopter pour les migrations de base de données destructrices (ex: renommer une colonne) en ZDD ?",
      "type": "single_choice",
      "options": [
        "Tout faire en une fois.",
        "Pattern 'Expand and Contract' : Ajouter la nouvelle colonne, écrire dans les deux, migrer les données, puis supprimer l'ancienne colonne dans un déploiement ultérieur.",
        "Arrêter le site pendant la migration.",
        "Ne jamais renommer de colonne."
      ],
      "correct_answers": [
        "Pattern 'Expand and Contract' : Ajouter la nouvelle colonne, écrire dans les deux, migrer les données, puis supprimer l'ancienne colonne dans un déploiement ultérieur."
      ],
      "explanation": "Cela permet au code V1 (qui utilise l'ancienne colonne) et V2 (qui utilise la nouvelle) de coexister."
    },
    {
      "id": 4,
      "question": "Pourquoi faut-il redémarrer (ou reloader) PHP-FPM après un déploiement atomique (symlink) ?",
      "type": "single_choice",
      "options": [
        "Pour vider la mémoire.",
        "Parce que le cache OPcache conserve les anciens fichiers en mémoire (surtout si `validate_timestamps=0`).",
        "C'est inutile.",
        "Pour relancer Nginx."
      ],
      "correct_answers": [
        "Parce que le cache OPcache conserve les anciens fichiers en mémoire (surtout si `validate_timestamps=0`)."
      ],
      "explanation": "Sans reload, PHP continuerait d'exécuter l'ancien code qui est en cache RAM, même si les fichiers disques ont changé."
    },
    {
      "id": 5,
      "question": "Quel est l'intérêt d'utiliser des 'Feature Flags' (Bascule de fonctionnalité) ?",
      "type": "single_choice",
      "options": [
        "Améliorer le SEO.",
        "Découpler le déploiement du code de l'activation de la fonctionnalité, permettant un déploiement continu même si la fonctionnalité n'est pas finie ou doit être activée progressivement.",
        "Gérer les drapeaux de langue.",
        "C'est une fonctionnalité de Git."
      ],
      "correct_answers": [
        "Découpler le déploiement du code de l'activation de la fonctionnalité, permettant un déploiement continu même si la fonctionnalité n'est pas finie ou doit être activée progressivement."
      ],
      "explanation": "Cela permet de tester en prod (pour certains utilisateurs) et de faire un rollback instantané (désactivation) sans redéployer."
    },
    {
      "id": 6,
      "question": "Pourquoi les changements DB destructeurs sont dangereux en ZDD ?",
      "type": "single_choice",
      "options": [
        "Parce que code V1 et V2 doivent fonctionner avec la même DB pendant le déploiement",
        "Parce que Doctrine l'interdit",
        "Parce que Git échoue",
        "Parce que Redis crash"
      ],
      "correct_answers": [
        "Parce que code V1 et V2 doivent fonctionner avec la même DB pendant le déploiement"
      ],
      "explanation": "Il faut des migrations compatibles (expand/contract)."
    },
    {
      "id": 7,
      "question": "Quel pattern apply pour renommer une colonne sans downtime ?",
      "type": "single_choice",
      "options": [
        "Expand and Contract en plusieurs déploiements",
        "Renommer en une fois",
        "Supprimer puis créer",
        "Utiliser ftp"
      ],
      "correct_answers": [
        "Expand and Contract en plusieurs déploiements"
      ],
      "explanation": "Ajouter colonne, écrire double, migrer, puis supprimer."
    },
    {
      "id": 8,
      "question": "Pourquoi un reload PHP-FPM est-il préféré à un restart brutal ?",
      "type": "single_choice",
      "options": [
        "Reload est gracieux et ne coupe pas les connexions en cours",
        "Restart est plus rapide",
        "Restart vide Redis",
        "Reload supprime les logs"
      ],
      "correct_answers": [
        "Reload est gracieux et ne coupe pas les connexions en cours"
      ],
      "explanation": "Reload charge la nouvelle codebase sans tuer brutalement les requêtes."
    },
    {
      "id": 9,
      "question": "Pourquoi stocker les sessions en Redis aide en ZDD ?",
      "type": "single_choice",
      "options": [
        "Sessions partagées entre instances, évite les pertes lors du basculement",
        "Plus rapide que PHP",
        "Obligatoire",
        "Désactive les cookies"
      ],
      "correct_answers": [
        "Sessions partagées entre instances, évite les pertes lors du basculement"
      ],
      "explanation": "Un backend partagé rend le sticky non nécessaire."
    },
    {
      "id": 10,
      "question": "Quel mécanisme sépare déploiement et activation de features ?",
      "type": "single_choice",
      "options": [
        "Feature Flags / Toggles",
        "OPcache",
        "Git branches",
        "Xdebug"
      ],
      "correct_answers": [
        "Feature Flags / Toggles"
      ],
      "explanation": "Permet activation progressive ou rollback immédiat sans déployer."
    }
  ]
}