{
  "source_file": "14-divers/deployment.md",
  "title": "Bonnes Pratiques de Déploiement",
  "questions": [
    {
      "id": 1,
      "question": "Quelle commande Composer optimiser en prod ?",
      "type": "single_choice",
      "options": [
        "`composer install --no-dev --optimize-autoloader`",
        "`composer update`",
        "`composer install`",
        "`composer dump-autoload`"
      ],
      "correct_answers": [
        "`composer install --no-dev --optimize-autoloader`"
      ],
      "explanation": "No-dev + autoloader optimisé pour la prod."
    },
    {
      "id": 2,
      "question": "Quelle directive PHP (php.ini) est cruciale pour les performances en production mais nécessite un redémarrage de PHP-FPM à chaque déploiement ?",
      "type": "single_choice",
      "options": [
        "`memory_limit=-1`",
        "`opcache.validate_timestamps=0`",
        "`display_errors=Off`",
        "`max_execution_time=30`"
      ],
      "correct_answers": [
        "`opcache.validate_timestamps=0`"
      ],
      "explanation": "Cette directive empêche PHP de vérifier si les fichiers ont changé sur le disque à chaque requête, éliminant beaucoup d'I/O. En contrepartie, le code n'est jamais rechargé sans restart."
    },
    {
      "id": 3,
      "question": "Comment gérer les migrations de base de données en production ?",
      "type": "single_choice",
      "options": [
        "Utiliser `doctrine:schema:update --force`.",
        "Utiliser `doctrine:migrations:migrate --no-interaction`.",
        "Le faire manuellement via PhpMyAdmin.",
        "Supprimer et recréer la base."
      ],
      "correct_answers": [
        "Utiliser `doctrine:migrations:migrate --no-interaction`."
      ],
      "explanation": "`schema:update` est dangereux et réservé au développement. Les migrations permettent un versioning contrôlé et réversible des changements de schéma."
    },
    {
      "id": 4,
      "question": "Pourquoi utilise-t-on la commande `composer dump-env prod` ?",
      "type": "single_choice",
      "options": [
        "Pour supprimer le fichier `.env`.",
        "Pour compiler tous les fichiers `.env` en un seul fichier PHP statique optimisé (`.env.local.php`).",
        "Pour chiffrer les variables d'environnement.",
        "Pour valider la syntaxe du fichier `.env`."
      ],
      "correct_answers": [
        "Pour compiler tous les fichiers `.env` en un seul fichier PHP statique optimisé (`.env.local.php`)."
      ],
      "explanation": "Cela évite à Symfony de devoir parser les fichiers `.env` à chaque requête, ce qui est coûteux."
    },
    {
      "id": 5,
      "question": "Quelle variable d'environnement doit absolument être définie à `0` (zéro) en production pour désactiver le mode debug ?",
      "type": "single_choice",
      "options": [
        "`APP_DEBUG`",
        "`APP_ENV`",
        "`SYMFONY_DEBUG`",
        "`DEBUG_MODE`"
      ],
      "correct_answers": [
        "`APP_DEBUG`"
      ],
      "explanation": "`APP_DEBUG=0` désactive le profiler, le re-parsing des fichiers de config à chaque requête et les pages d'erreur détaillées."
    },
    {
      "id": 6,
      "question": "Pourquoi éviter `doctrine:schema:update --force` en prod ?",
      "type": "single_choice",
      "options": [
        "Non versionné, risque de perte de données, pas de rollback",
        "Trop lent",
        "Obligatoire en dev",
        "Parce que migrations est plus lent"
      ],
      "correct_answers": [
        "Non versionné, risque de perte de données, pas de rollback"
      ],
      "explanation": "Les migrations offrent du contrôle et un historique."
    },
    {
      "id": 7,
      "question": "Pourquoi `APP_ENV=prod APP_DEBUG=0 php bin/console cache:clear` lors du déploiement ?",
      "type": "single_choice",
      "options": [
        "Pour warmup le cache/contener/routes/templates et éviter la lenteur pour le premier utilisateur",
        "Pour vider la base",
        "Pour supprimer les logs",
        "Pour recompiler Composer"
      ],
      "correct_answers": [
        "Pour warmup le cache/contener/routes/templates et éviter la lenteur pour le premier utilisateur"
      ],
      "explanation": "Le warmup prépare le cache prod."
    },
    {
      "id": 8,
      "question": "Pourquoi préférer un déploiement atomique (symlink) ?",
      "type": "single_choice",
      "options": [
        "Basculer instantanément vers la nouvelle release sans downtime",
        "Parce que git l'impose",
        "Pour éviter les migrations",
        "Pour supprimer les assets"
      ],
      "correct_answers": [
        "Basculer instantanément vers la nouvelle release sans downtime"
      ],
      "explanation": "On prépare une release complète puis on switch le lien `current`."
    },
    {
      "id": 9,
      "question": "Pourquoi faut-il définir `APP_ENV=prod` AVANT l'installation Composer en CI/CD ?",
      "type": "single_choice",
      "options": [
        "Certains scripts post-install dépendent de l'env pour charger la bonne config",
        "Sinon Composer échoue",
        "Pour activer debug",
        "Pour générer .env"
      ],
      "correct_answers": [
        "Certains scripts post-install dépendent de l'env pour charger la bonne config"
      ],
      "explanation": "Env propage aux scripts et influence les paquets dev/no-dev."
    },
    {
      "id": 10,
      "question": "Quel package vérifier en environnement mutualisé Apache ?",
      "type": "single_choice",
      "options": [
        "`symfony/apache-pack` pour .htaccess",
        "`symfony/asset-mapper`",
        "`symfony/webpack-encore-bundle`",
        "`doctrine/doctrine-bundle`"
      ],
      "correct_answers": [
        "`symfony/apache-pack` pour .htaccess"
      ],
      "explanation": "apache-pack installe la conf .htaccess adaptée."
    }
  ]
}